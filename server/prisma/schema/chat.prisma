model Chat {
    id Int @id @default(autoincrement())
    type ChatType @default(ORDER)

    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @updatedAt @map("updated_at")
    
    orderId Int?  @unique @map("order_id")
    order Order?  @relation(fields: [orderId], references: [id])
    participants ChatParticipant[]
    messages Message[]

    @@index([orderId])
}

model Message {
    id Int @id @default(autoincrement())
    content String

    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @updatedAt @map("updated_at")

    userId Int @map("user_id")
    user User @relation(fields: [userId], references: [id])
    chatId Int @map("chat_id")
    chat Chat @relation(fields: [chatId], references: [id])

    @@unique([chatId, userId])
}

model ChatParticipant {
    chatId Int @map("chat_id")
    chat Chat @relation(fields: [chatId], references: [id])
    userId Int @map("user_id")
    user User @relation(fields: [userId], references: [id])

    @@unique([chatId, userId])
    @@map("chat_participants")
}

enum ChatType {
    ORDER  
    SUPPORT  
}